# 精简成片功能架构图

## 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                    FineCutPage                              │
│  ┌─────────────────────┐  ┌─────────────────────────────┐  │
│  │  FineCutLeftPanel   │  │    FineCutRightPanel        │  │
│  │                     │  │                             │  │
│  │  ┌───────────────┐  │  │  ┌─────────────────────┐   │  │
│  │  │ProductSelector│  │  │  │    VideoTask        │   │  │
│  │  └───────────────┘  │  │  │  ┌───────────────┐  │   │  │
│  │                     │  │  │  │   VideoCard    │  │   │  │
│  │  ┌───────────────┐  │  │  │  └───────────────┘  │   │  │
│  │  │MaterialSelector│  │  │  └─────────────────────┘   │  │
│  │  │  (Modal)      │  │  │                             │  │
│  │  └───────────────┘  │  │  ┌─────────────────────┐   │  │
│  │                     │  │  │    VideoPreview     │   │  │
│  │  ┌───────────────┐  │  │  │      (Modal)        │   │  │
│  │  │  GenerateBtn  │  │  │  └─────────────────────┘   │  │
│  │  └───────────────┘  │  │                             │  │
│  └─────────────────────┘  └─────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## 状态管理 (Zustand Store)

```
┌─────────────────────────────────────────────────────────────┐
│                    FineCutStore                             │
│                                                             │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐ │
│  │   商品状态       │  │    素材状态      │  │  生成状态    │ │
│  │                 │  │                 │  │             │ │
│  │ products[]      │  │ mainVideos[]    │  │ isGenerating│ │
│  │ selectedProduct │  │ prefixVideos[]  │  │ generatedVideos│
│  │ productsLoading │  │ maskImages[]    │  │ loadingTasks│ │
│  │                 │  │ materialsLoading│  │             │ │
│  └─────────────────┘  └─────────────────┘  └─────────────┘ │
│                                                             │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐ │
│  │   选择状态       │  │   操作方法       │  │  工具方法    │ │
│  │                 │  │                 │  │             │ │
│  │ selectedMainVideo│  │ fetchProducts() │  │ clearState()│ │
│  │ selectedPrefixVideos│ fetchMainVideos()│ resetSelections│
│  │ selectedMaskImages│  │ generateVideo() │  │             │ │
│  └─────────────────┘  └─────────────────┘  └─────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

## 数据流

```
1. 用户选择商品
   ↓
2. 自动加载对应素材文件夹
   ├── 主视频文件夹 (mainFolderId)
   ├── 前贴视频文件夹 (prefixFolderId)  
   └── 蒙层图片文件夹 (picFolderId)
   ↓
3. 用户选择素材
   ├── 主视频 (必选)
   ├── 前贴视频 (可选)
   └── 蒙层图片 (必选)
   ↓
4. 点击生成按钮
   ↓
5. 表单验证
   ├── 商品必选
   ├── 主视频必选
   └── 蒙层图片必选
   ↓
6. 创建Loading任务
   ↓
7. 调用生成API (目前Mock)
   ↓
8. 更新任务状态
   ├── Loading → Completed
   └── 显示生成结果
```

## 组件交互

```
FineCutLeftPanel
├── ProductSelector
│   ├── 搜索商品
│   ├── 分页加载
│   └── 选择商品 → 触发素材加载
│
├── MaterialSelector (Modal)
│   ├── 主视频选择 (单选)
│   ├── 前贴视频选择 (多选)
│   ├── 蒙层图片选择 (多选)
│   └── 素材预览功能
│
└── GenerateBtn
    └── 表单验证 → 调用生成API

FineCutRightPanel
├── VideoTask
│   ├── Loading状态显示
│   └── 完成状态显示
│
├── VideoCard
│   ├── 视频预览
│   ├── 下载功能
│   └── 重新生成
│
└── VideoPreview (Modal)
    └── 全屏视频预览
```

## API集成

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   商品API       │    │    素材API      │    │   生成API       │
│                 │    │                 │    │                 │
│ getProductList()│    │ getMaterialList()│   │ generateVideo() │
│ - 分页查询      │    │ - 按文件夹查询   │    │ - 创建生成任务   │
│ - 搜索功能      │    │ - 类型过滤      │    │ - 返回任务ID    │
│ - 返回商品列表  │    │ - 返回素材列表  │    │ - 轮询状态      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 关键特性

1. **智能联动**: 选择商品自动加载对应素材
2. **状态管理**: Loading任务机制管理异步生成
3. **用户体验**: 实时反馈、预览、下载功能
4. **表单验证**: 确保必填项完整
5. **代码复用**: 双页面共享组件和状态
